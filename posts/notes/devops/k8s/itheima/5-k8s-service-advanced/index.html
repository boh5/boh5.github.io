<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>K8s 学习笔记（五）Service 详解 - 黄波的博客</title><meta name=author content="黄波"><meta name=author-link content="https://boh5.com"><meta name=description content="1. Service 介绍 在kubernetes中，pod是应用程序的载体，我们可以通过pod的ip来访问应用程序，但是pod的ip地址不是固定的，这也就意味"><meta name=keywords content="K8s,Kubernetes,pod,service,ingress"><meta itemprop=name content="K8s 学习笔记（五）Service 详解"><meta itemprop=description content="1. Service 介绍 在kubernetes中，pod是应用程序的载体，我们可以通过pod的ip来访问应用程序，但是pod的ip地址不是固定的，这也就意味"><meta itemprop=datePublished content="2022-08-21T16:16:00+08:00"><meta itemprop=dateModified content="2022-08-21T16:16:00+08:00"><meta itemprop=wordCount content="3603"><meta itemprop=image content="https://boh5.com/apple-touch-icon.png"><meta itemprop=keywords content="K8s,Kubernetes,pod,service,ingress,"><meta property="og:title" content="K8s 学习笔记（五）Service 详解"><meta property="og:description" content="1. Service 介绍 在kubernetes中，pod是应用程序的载体，我们可以通过pod的ip来访问应用程序，但是pod的ip地址不是固定的，这也就意味"><meta property="og:type" content="article"><meta property="og:url" content="https://boh5.com/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/"><meta property="og:image" content="https://boh5.com/apple-touch-icon.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-21T16:16:00+08:00"><meta property="article:modified_time" content="2022-08-21T16:16:00+08:00"><meta property="og:site_name" content="黄波的博客"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://boh5.com/apple-touch-icon.png"><meta name=twitter:title content="K8s 学习笔记（五）Service 详解"><meta name=twitter:description content="1. Service 介绍 在kubernetes中，pod是应用程序的载体，我们可以通过pod的ip来访问应用程序，但是pod的ip地址不是固定的，这也就意味"><meta name=application-name content="黄波的博客"><meta name=apple-mobile-web-app-title content="黄波的博客"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#252627"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://boh5.com/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/><link rel=prev href=https://boh5.com/posts/notes/devops/k8s/itheima/4-k8s-pod-controller-advanced/><link rel=next href=https://boh5.com/posts/notes/devops/k8s/itheima/6-k8s-volume/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><meta name=google-site-verification content="3_Zf27e0mNtTIsBWn36hi_d4KTxPd2Zh1dsZMVnKK8k"><meta name=baidu-site-verification content="code-VsfDko5mls"><meta name=360-site-verification content="1a8490494ad7f3fe3e0f7e4a61ce0775"><meta name=sogou_site_verification content="2dnMvyemIm"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"K8s 学习笔记（五）Service 详解","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/boh5.com\/posts\/notes\/devops\/k8s\/itheima\/5-k8s-service-advanced\/"},"genre":"posts","keywords":"K8s, Kubernetes, pod, service, ingress","wordcount":3603,"url":"https:\/\/boh5.com\/posts\/notes\/devops\/k8s\/itheima\/5-k8s-service-advanced\/","datePublished":"2022-08-21T16:16:00+08:00","dateModified":"2022-08-21T16:16:00+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"黄波"},"description":""}</script></head><body header-desktop=sticky header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper github-corner=right><div class=header-title><a href=/ title=黄波的博客><img class="lazyload logo" src=/svg/loading.min.svg data-src=/apple-touch-icon.png data-srcset="/apple-touch-icon.png, /apple-touch-icon.png 1.5x, /apple-touch-icon.png 2x" data-sizes=auto alt=黄波的博客 title=黄波的博客><span class=header-title-text>黄波的博客</span></a><span class=header-subtitle>开发、学习、生活、技术分享</span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class='fa-solid fa-archive fa-fw fa-sm'></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class='fa-solid fa-th fa-fw fa-sm'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class='fa-solid fa-tags fa-fw fa-sm'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/><i class='fa-solid fa-book fa-fw fa-sm'></i> 学习笔记</a></li><li class=menu-item><a class=menu-link href=/about/><i class='fa-solid fa-info-circle fa-fw fa-sm'></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item language"><span title=选择语言>简体中文<i class="dropdown-icon fa-solid fa-chevron-down"></i></span><ul class=sub-menu><li class=menu-item>没有更多翻译</li></ul></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=黄波的博客><img class="lazyload logo" src=/svg/loading.min.svg data-src=/apple-touch-icon.png data-srcset="/apple-touch-icon.png, /apple-touch-icon.png 1.5x, /apple-touch-icon.png 2x" data-sizes=auto alt=/apple-touch-icon.png title=/apple-touch-icon.png><span class=header-title-text>黄波的博客</span></a><span class=header-subtitle>开发、学习、生活、技术分享</span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/><i class='fa-solid fa-archive fa-fw fa-sm'></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class='fa-solid fa-th fa-fw fa-sm'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class='fa-solid fa-tags fa-fw fa-sm'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/><i class='fa-solid fa-book fa-fw fa-sm'></i> 学习笔记</a></li><li class=menu-item><a class=menu-link href=/about/><i class='fa-solid fa-info-circle fa-fw fa-sm'></i> 关于</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li><li class="menu-item language"><span title=选择语言>简体中文<i class="dropdown-icon fa-solid fa-chevron-down"></i></span>
<select class=language-select onchange="location=this.value"><option disabled>没有更多翻译</option></select></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录 <i class="toc-icon fa-solid fa-angle-down fa-fw"></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>K8s 学习笔记（五）Service 详解</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://boh5.com title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><i class="fa-solid fa-user-circle"></i>
黄波</a></span>
<span class=post-category>收录于 <a href=/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/><i class="fa-regular fa-folder fa-fw"></i>&nbsp;学习笔记</a>&ensp;<a href=/categories/k8s/><i class="fa-regular fa-folder fa-fw"></i>&nbsp;K8s</a></span></div><div class=post-meta-line><span title="2022-08-21 16:16:00"><i class="fa-regular fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-08-21>2022-08-21</time>
</span>&nbsp;<i class="fa-solid fa-pencil-alt fa-fw"></i>&nbsp;约 3603 字&nbsp;
<i class="fa-regular fa-clock fa-fw"></i>&nbsp;预计阅读 8 分钟&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title="K8s 学习笔记（五）Service 详解">
<i class="fa-regular fa-eye fa-fw"></i>&nbsp;<span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-service-介绍>1. Service 介绍</a><ul><li><a href=#11-kube-proxy-的三种工作模式>1.1 kube-proxy 的三种工作模式</a><ul><li><a href=#111-userspace模式>1.1.1 userspace模式</a></li><li><a href=#112-iptables-模式>1.1.2 iptables 模式</a></li><li><a href=#113-ipvs-模式>1.1.3 ipvs 模式</a></li></ul></li></ul></li><li><a href=#2-service-类型>2. Service 类型</a><ul><li><a href=#21-clusterip>2.1 ClusterIP</a></li><li><a href=#22-headless>2.2 Headless</a></li><li><a href=#23-nodeport>2.3 NodePort</a></li><li><a href=#24-loadbalancer>2.4 LoadBalancer</a></li><li><a href=#25-externalname>2.5 ExternalName</a></li></ul></li><li><a href=#3-ingress>3. Ingress</a><ul><li><a href=#31-ingress-介绍>3.1 Ingress 介绍</a></li><li><a href=#32-ingress-的使用>3.2 Ingress 的使用</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=1-service-介绍>1. Service 介绍</h2><p>在kubernetes中，pod是应用程序的载体，我们可以通过pod的ip来访问应用程序，但是pod的ip地址不是固定的，这也就意味着不方便直接采用pod的ip对服务进行访问。</p><p>为了解决这个问题，kubernetes提供了Service资源，Service会对提供同一个服务的多个pod进行聚合，并且提供一个统一的入口地址。通过访问Service的入口地址就能访问到后面的pod服务。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=images/image-20200408194716912.png data-srcset="/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200408194716912.png, images/image-20200408194716912.png 1.5x, /posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200408194716912.png 2x" data-sizes=auto alt=/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200408194716912.png title=Service></p><p>Service在很多情况下只是一个<strong>概念</strong>，真正起作用的其实是<strong>kube-proxy</strong>服务进程，每个Node节点上都运行着一个kube-proxy服务进程。当创建Service的时候会通过api-server向etcd写入创建的service的信息，而kube-proxy会基于监听的机制发现这种Service的变动，然后<strong>它会将最新的Service信息转换成对应的访问规则</strong>。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=images/image-20200509121254425.png data-srcset="/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200509121254425.png, images/image-20200509121254425.png 1.5x, /posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200509121254425.png 2x" data-sizes=auto alt=/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200509121254425.png title=kube-proxy></p><h3 id=11-kube-proxy-的三种工作模式>1.1 kube-proxy 的三种工作模式</h3><h4 id=111-userspace模式>1.1.1 userspace模式</h4><p>userspace模式下，kube-proxy会为每一个Service创建一个监听端口，发向Cluster IP的请求被Iptables规则重定向到kube-proxy监听的端口上，kube-proxy根据LB算法选择一个提供服务的Pod并和其建立链接，以将请求转发到Pod上。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=images/image-20200509151424280.png data-srcset="/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200509151424280.png, images/image-20200509151424280.png 1.5x, /posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200509151424280.png 2x" data-sizes=auto alt=/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200509151424280.png title=userspace模式></p><ul><li>kube-proxy充当了一个四层负责均衡器的角色</li><li>kube-proxy运行在userspace中，在进行转发处理时会增加内核和用户空间之间的数据拷贝，虽然比较稳定，但是效率比较低。</li></ul><h4 id=112-iptables-模式>1.1.2 iptables 模式</h4><p>iptables模式下，kube-proxy为service后端的每个Pod创建对应的iptables规则，直接将发向Cluster IP的请求重定向到一个Pod IP。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=images/image-20200509152947714.png data-srcset="/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200509152947714.png, images/image-20200509152947714.png 1.5x, /posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200509152947714.png 2x" data-sizes=auto alt=/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200509152947714.png title="iptables 模式"></p><ul><li>kube-proxy不承担四层负责均衡器的角色，只负责创建iptables规则</li><li>较userspace模式效率更高，但不能提供灵活的LB策略，当后端Pod不可用时也无法进行重试</li></ul><h4 id=113-ipvs-模式>1.1.3 ipvs 模式</h4><p>pvs模式和iptables类似，kube-proxy监控Pod的变化并创建相应的ipvs规则。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=images/image-20200509153731363.png data-srcset="/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200509153731363.png, images/image-20200509153731363.png 1.5x, /posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200509153731363.png 2x" data-sizes=auto alt=/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200509153731363.png title="ipvs 模式"></p><ul><li>ipvs相对iptables转发效率更高</li><li>ipvs支持更多的LB算法</li><li>此模式必须安装ipvs内核模块，否则会降级为iptables</li></ul><p>启用 ipvs：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 编辑 kube-proxy 的 ConfigMap，设置 data.config_conf.mode = &#34;ipvs&#34;</span>
</span></span><span class=line><span class=cl>kubectl edit cm kube-proxy -n kube-system  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 删除已存在的 kube-proxy，让系统新建</span>
</span></span><span class=line><span class=cl>kubectl delete pod -l k8s-app<span class=o>=</span>kube-proxy -n kube-system
</span></span></code></pre></td></tr></table></div></div><h2 id=2-service-类型>2. Service 类型</h2><p><strong>Service 的资源清单</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1 </span><span class=w> </span><span class=c># 资源版本</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service </span><span class=w> </span><span class=c># 资源类型</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w> </span><span class=c># 元数据</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>service</span><span class=w> </span><span class=c># 资源名称</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>dev</span><span class=w> </span><span class=c># 命名空间</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w> </span><span class=c># 描述</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w> </span><span class=c># 标签选择器，用于确定当前service代理哪些pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP</span><span class=w> </span><span class=c># Service类型，指定service的访问方式</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>clusterIP</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=c># 虚拟服务的ip地址，默认随机值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>sessionAffinity</span><span class=p>:</span><span class=w> </span><span class=l>ClientIP</span><span class=w> </span><span class=c># session亲和性，支持ClientIP(同一个客户的的请求打到同一个pod)、None两个选项</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w> </span><span class=c># 端口信息</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>3017</span><span class=w>  </span><span class=c># service端口</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>5003</span><span class=w> </span><span class=c># pod端口</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class=m>31122</span><span class=w> </span><span class=c># 主机端口</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Service 类型：</p><ul><li>ClusterIP：<strong>默认值</strong>，它是Kubernetes系统自动分配的虚拟IP，只能在集群<strong>内部访问</strong></li><li>HeadLiness(ClusterIP 类型，并把 clusterIP 设为 None)：这类Service<strong>不会分配Cluster IP</strong>，如果想要访问service，只能通过service的<strong>域名</strong>进行查询</li><li>NodePort：将Service通过指定的Node上的端口暴露给外部，通过此方法，就可以在集群<strong>外部访问</strong>服务</li><li>LoadBalancer：使用<strong>外接负载均衡器</strong>完成到服务的负载分发，注意此模式需要外部云环境支持</li><li>ExternalName： 把集群<strong>外部的服务引入集群内部</strong>，直接使用</li></ul><h3 id=21-clusterip>2.1 ClusterIP</h3><p><strong>ClusterIP Service 资源清单</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>service-clusterip</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx-pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>clusterIP</span><span class=p>:</span><span class=w> </span><span class=m>10.97.97.97</span><span class=w> </span><span class=c># service的ip地址，如果不写，默认会生成一个</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>  </span><span class=c># Service端口       </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w> </span><span class=c># pod端口</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>查看 ClusterIP 类型 service 的详细信息</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 在这里有一个Endpoints列表，里面就是当前service可以负载到的服务入口</span>
</span></span><span class=line><span class=cl>$ kubectl describe svc service-clusterip -n dev
</span></span><span class=line><span class=cl>Name:              service-clusterip
</span></span><span class=line><span class=cl>Namespace:         dev
</span></span><span class=line><span class=cl>Labels:            &lt;none&gt;
</span></span><span class=line><span class=cl>Annotations:       &lt;none&gt;
</span></span><span class=line><span class=cl>Selector:          <span class=nv>app</span><span class=o>=</span>nginx-pod
</span></span><span class=line><span class=cl>Type:              ClusterIP
</span></span><span class=line><span class=cl>IP:                10.97.97.97
</span></span><span class=line><span class=cl>Port:              &lt;unset&gt;  80/TCP
</span></span><span class=line><span class=cl>TargetPort:        80/TCP
</span></span><span class=line><span class=cl>Endpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80
</span></span><span class=line><span class=cl>Session Affinity:  None
</span></span><span class=line><span class=cl>Events:            &lt;none&gt;
</span></span></code></pre></td></tr></table></div></div><p>添加 Service 后可以看到 ipvs 映射规则</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo ipvsadm -Ln
</span></span><span class=line><span class=cl>IP Virtual Server version 1.2.1 <span class=o>(</span><span class=nv>size</span><span class=o>=</span>4096<span class=o>)</span>
</span></span><span class=line><span class=cl>Prot LocalAddress:Port Scheduler Flags
</span></span><span class=line><span class=cl>  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn
</span></span><span class=line><span class=cl>TCP  172.17.0.1:31070 rr
</span></span><span class=line><span class=cl>  -&gt; 10.244.1.48:80               Masq    <span class=m>1</span>      <span class=m>0</span>          <span class=m>0</span>
</span></span><span class=line><span class=cl>TCP  192.168.31.101:31070 rr
</span></span><span class=line><span class=cl>  -&gt; 10.244.1.48:80               Masq    <span class=m>1</span>      <span class=m>0</span>          <span class=m>0</span>
</span></span><span class=line><span class=cl>TCP  10.96.0.1:443 rr
</span></span><span class=line><span class=cl>  -&gt; 192.168.31.101:6443          Masq    <span class=m>1</span>      <span class=m>0</span>          <span class=m>0</span>
</span></span><span class=line><span class=cl>TCP  10.96.0.10:53 rr
</span></span><span class=line><span class=cl>  -&gt; 10.244.0.4:53                Masq    <span class=m>1</span>      <span class=m>0</span>          <span class=m>0</span>
</span></span><span class=line><span class=cl>  -&gt; 10.244.0.5:53                Masq    <span class=m>1</span>      <span class=m>0</span>          <span class=m>0</span>
</span></span><span class=line><span class=cl>TCP  10.96.0.10:9153 rr
</span></span><span class=line><span class=cl>  -&gt; 10.244.0.4:9153              Masq    <span class=m>1</span>      <span class=m>0</span>          <span class=m>0</span>
</span></span><span class=line><span class=cl>  -&gt; 10.244.0.5:9153              Masq    <span class=m>1</span>      <span class=m>0</span>          <span class=m>0</span>
</span></span><span class=line><span class=cl>TCP  10.97.97.97:80 rr  <span class=c1># 这里就是我们创建的 service 生成的 ipvs 转发规则，rr 表示轮询</span>
</span></span><span class=line><span class=cl>  -&gt; 10.244.1.57:80               Masq    <span class=m>1</span>      <span class=m>0</span>          <span class=m>0</span>
</span></span><span class=line><span class=cl>  -&gt; 10.244.2.67:80               Masq    <span class=m>1</span>      <span class=m>0</span>          <span class=m>0</span>
</span></span><span class=line><span class=cl>  -&gt; 10.244.2.68:80               Masq    <span class=m>1</span>      <span class=m>0</span>          <span class=m>0</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Endpoints</strong></p><p>Endpoints是kubernetes中的一个资源对象，存储在etcd中，用来记录一个service对应的所有pod的访问地址，它是根据service配置文件中selector描述产生的。</p><p>一个Service由一组Pod组成，这些Pod通过Endpoints暴露出来，<strong>Endpoints是实现实际服务的端点集合</strong>。换句话说，service和pod之间的联系是通过endpoints实现的。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=images/image-20200509191917069.png data-srcset="/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200509191917069.png, images/image-20200509191917069.png 1.5x, /posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200509191917069.png 2x" data-sizes=auto alt=/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200509191917069.png title=Endpoints></p><p><strong>负载分发策略(sessionAffinity)</strong></p><p>对Service的访问被分发到了后端的Pod上去，目前kubernetes提供了两种负载分发策略：</p><ul><li>None: 如果不定义，默认使用kube-proxy的策略，比如随机、轮询</li><li>ClientIP: 基于客户端地址的会话保持模式，即来自同一个客户端发起的所有请求都会转发到固定的一个Pod上</li></ul><h3 id=22-headless>2.2 Headless</h3><p>在某些场景中，开发人员可能不想使用Service提供的负载均衡功能，而希望自己来控制负载均衡策略，针对这种情况，kubernetes提供了HeadLess Service，这类Service不会分配Cluster IP，如果想要访问service，只能通过service的域名进行查询。</p><p><strong>Headless Service 资源清单</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>service-headless</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx-pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>clusterIP</span><span class=p>:</span><span class=w> </span><span class=l>None</span><span class=w> </span><span class=c># 将clusterIP设置为None，即可创建headless Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=23-nodeport>2.3 NodePort</h3><p>NodePort的工作原理是<strong>将service的端口映射到Node的一个端口上</strong>，然后就可以通过<code>NodeIp:NodePort</code>来访问service了。</p><p><strong>NodePort Service 资源清单</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>service-nodeport</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx-pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w> </span><span class=c># service类型</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class=m>30002</span><span class=w> </span><span class=c># 指定绑定的node的端口(默认的取值范围是：30000-32767), 如果不指定，会默认分配</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=24-loadbalancer>2.4 LoadBalancer</h3><p>LoadBalancer和NodePort很相似，目的都是向外部暴露一个端口，区别在于LoadBalancer会在集群的外部再来做一个负载均衡设备，而这个设备需要外部环境支持的，外部服务发送到这个设备上的请求，会被设备负载之后转发到集群中。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=images/image-20200510103945494.png data-srcset="/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200510103945494.png, images/image-20200510103945494.png 1.5x, /posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200510103945494.png 2x" data-sizes=auto alt=/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200510103945494.png title=LoadBalancer></p><h3 id=25-externalname>2.5 ExternalName</h3><p>引入集群外部的服务，它通过<code>externalName</code>属性指定外部一个服务的地址，然后在集群内部访问此service就可以访问到外部的服务了。</p><p><strong>ExternalName Service 资源清单</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>service-externalname</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ExternalName</span><span class=w> </span><span class=c># service类型</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>externalName</span><span class=p>:</span><span class=w> </span><span class=l>www.baidu.com </span><span class=w> </span><span class=c>#改成ip地址也可以</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=3-ingress>3. Ingress</h2><h3 id=31-ingress-介绍>3.1 Ingress 介绍</h3><p>service对集群之外暴露服务的主要方式有两种：NotePort和LoadBalancer，但是这两种方式，都有一定的缺点：</p><ul><li>NodePort方式的缺点是会占用很多集群机器的端口，那么当集群服务变多的时候，这个缺点就愈发明显</li><li>LB方式的缺点是每个service需要一个LB，浪费、麻烦，并且需要kubernetes之外设备的支持</li></ul><p>kubernetes提供了Ingress资源对象，Ingress只需要一个NodePort或者一个LB就可以满足暴露多个Service的需求。工作机制大致如下图表示：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=images/image-20200623092808049.png data-srcset="/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200623092808049.png, images/image-20200623092808049.png 1.5x, /posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200623092808049.png 2x" data-sizes=auto alt=/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200623092808049.png title="Ingress 介绍"></p><p>Ingress相当于一个7层的负载均衡器，是kubernetes对反向代理的一个抽象，它的工作原理类似于Nginx，可以理解成在<strong>Ingress里建立诸多映射规则，Ingress Controller通过监听这些配置规则并转化成Nginx的反向代理配置 , 然后对外部提供服务</strong>。</p><ul><li>ingress：kubernetes中的一个对象，作用是定义请求如何转发到service的规则</li><li>ingress controller：具体实现反向代理及负载均衡的程序，对ingress定义的规则进行解析，根据配置的规则来实现请求转发，实现方式有很多，比如Nginx, Contour, Haproxy等等</li></ul><p>Ingress（以Nginx为例）的工作原理如下：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=images/image-20200516112704764.png data-srcset="/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200516112704764.png, images/image-20200516112704764.png 1.5x, /posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200516112704764.png 2x" data-sizes=auto alt=/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/images/image-20200516112704764.png title=Ingress-Nginx></p><ol><li>用户编写Ingress规则，说明哪个域名对应kubernetes集群中的哪个Service</li><li>Ingress控制器动态感知Ingress服务规则的变化，然后生成一段对应的Nginx反向代理配置</li><li>Ingress控制器会将生成的Nginx配置写入到一个运行着的Nginx服务中，并动态更新</li><li>到此为止，其实真正在工作的就是一个Nginx了，内部配置了用户定义的请求转发规则</li></ol><h3 id=32-ingress-的使用>3.2 Ingress 的使用</h3><blockquote><p>gcr 镜像无法拉取，用 <a href=https://github.com/anjia0532/gcr.io_mirror target=_blank rel="external nofollow noopener noreferrer">gcr.io_mirror<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1"></i></a> 这个 mirror</p></blockquote><p><strong>Ingress 资源清单</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>networking.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ingress-http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>nginx.itheima.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>pathType</span><span class=p>:</span><span class=w> </span><span class=l>Prefix</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>backend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>port</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>tomcat.itheima.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>pathType</span><span class=p>:</span><span class=w> </span><span class=l>Prefix</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>backend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>tomcat-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>port</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2022-08-21 16:16:00">更新于 2022-08-21</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://boh5.com/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/ data-title="K8s 学习笔记（五）Service 详解" data-hashtags=K8s,Kubernetes,pod,service,ingress><i class="fa-brands fa-twitter fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://boh5.com/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/ data-hashtag=K8s><i class="fa-brands fa-facebook-square fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://boh5.com/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/ data-title="K8s 学习笔记（五）Service 详解" data-web><i class="fa-brands fa-whatsapp fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://boh5.com/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/ data-title="K8s 学习笔记（五）Service 详解"><i data-svg-src=/lib/simple-icons/icons/line.min.svg></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://boh5.com/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/ data-title="K8s 学习笔记（五）Service 详解"><i class="fa-brands fa-weibo fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Myspace" data-sharer=myspace data-url=https://boh5.com/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/ data-title="K8s 学习笔记（五）Service 详解" data-description><i data-svg-src=/lib/simple-icons/icons/myspace.min.svg></i></a>
<a href=javascript:void(0); title="分享到 Blogger" data-sharer=blogger data-url=https://boh5.com/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/ data-title="K8s 学习笔记（五）Service 详解" data-description><i class="fa-brands fa-blogger fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://boh5.com/posts/notes/devops/k8s/itheima/5-k8s-service-advanced/ data-title="K8s 学习笔记（五）Service 详解"><i class="fa-brands fa-evernote fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw"></i>&nbsp;<a href=/tags/k8s/>K8s</a>,&nbsp;<a href=/tags/kubernetes/>Kubernetes</a>,&nbsp;<a href=/tags/pod/>pod</a>,&nbsp;<a href=/tags/service/>service</a>,&nbsp;<a href=/tags/ingress/>ingress</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/notes/devops/k8s/itheima/4-k8s-pod-controller-advanced/ class=prev rel=prev title="K8s 学习笔记（四）Pod 控制器详解"><i class="fa-solid fa-angle-left fa-fw"></i>K8s 学习笔记（四）Pod 控制器详解</a>
<a href=/posts/notes/devops/k8s/itheima/6-k8s-volume/ class=next rel=next title="K8s 学习笔记（六）数据存储">K8s 学习笔记（六）数据存储<i class="fa-solid fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=giscus><script src=https://giscus.app/client.js data-repo=boh5/boh5.github.io data-repo-id=R_kgDOHr9Jag data-category=Announcements data-category-id=DIC_kwDOHr9Jas4CQ396 data-mapping=title data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.102.3">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel="external nofollow noopener noreferrer" title="FixIt v0.2.16-RC"><img class=fixit-icon src=/images/fixit.svg alt="FixIt logo">&nbsp;FixIt</a></div><div class="footer-line copyright"><i class="fa-regular fa-copyright fa-fw"></i>
<span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>
<a href=https://boh5.com target=_blank rel="external nofollow noopener noreferrer">黄波</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div><div class="footer-line ibruce"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw"></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa fa-spinner fa-spin fa-fw"></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw"></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa fa-spinner fa-spin fa-fw"></i></span></span></div></div></footer></div><div class=widgets><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fa-solid fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fa-solid fa-comment fa-fw"></i></a></div><a href=https://github.com/boh5 title="在 GitHub 上找到我" target=_blank rel="external nofollow noopener noreferrer" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js defer></script><script type=text/javascript src=/lib/lunr/lunr.min.js defer></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js defer></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js defer></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js async defer></script><script type=text/javascript src=/lib/sharer/sharer.min.js async defer></script><script type=text/javascript src=/lib/katex/katex.min.js defer></script><script type=text/javascript src=/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js defer></script><script type=text/javascript src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{giscus:{darkTheme:"dark",lightTheme:"light"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript src=/js/_custom.min.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Y7BJE11JP4",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-Y7BJE11JP4" async></script></body></html>